{"remainingRequest":"/home/qc/Documents/Coding/vuetify-clinic-dashboard-/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/qc/Documents/Coding/vuetify-clinic-dashboard-/src/views/DetailInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/qc/Documents/Coding/vuetify-clinic-dashboard-/src/views/DetailInfo.vue","mtime":1581225491753},{"path":"/home/qc/Documents/Coding/vuetify-clinic-dashboard-/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/qc/Documents/Coding/vuetify-clinic-dashboard-/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/qc/Documents/Coding/vuetify-clinic-dashboard-/node_modules/vuetify-loader/lib/loader.js","mtime":1564062719000},{"path":"/home/qc/Documents/Coding/vuetify-clinic-dashboard-/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/qc/Documents/Coding/vuetify-clinic-dashboard-/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n  export default {\n    data: () => ({\n      dates: ['2019-09-10', '2019-09-20'],\n      reportDisplay: false,\n      totalIncome: 0\n    }),\n\n    methods: {\n      actionGenerate: function(){\n        this.reportDisplay = true;\n        var start = this.dates[0];\n        var end = this.dates[1];\n        var range = {\n          startDate: start,\n          endDate: end,\n        };\n        this.startDay = start;\n        this.endDay = end;\n        var orderObj = [];\n        var otherEntryObj = [];\n        let days = 0;\n        days = (this.dateRange[1] - this.dateRange[0]) / (1000*3600*24) + 1;\n        this.$http.get(\"/ordapi/getOrderStatement\", {params:range})\n        .then(\n          function(response) {\n            orderObj = response.data;\n            this.$http.get(\"/othentryapi/getOtherEntryRange\", {params:range}).then(response => {\n              otherEntryObj = response.data;\n              this.calculateAndAnalysis(orderObj, otherEntryObj, days);\n            })\t\t\t\t\t\t\t\n          }\n        );\n      },\n\n      calculateAndAnalysis: function(orderObj,otherEntryObj,days){\n        //alert(orderObj.length);\n        //alert(otherEntryObj.length);\n        let _totalIncome = 0, _totalProfit = 0, _averageIncome = 0, _averageProfit = 0;\n        let _incomeMianjian = 0, _incomeXiyao = 0, _incomeYaowan = 0, _incomeCaoyao = 0;\n        let _profitMianjian = 0, _profitXiyao = 0, _profitYaowan = 0, _profitCaoyao = 0;\n        let _taotalPatient = 0, _averagePatient = 0, _gt20Patient = 0, _lt20Patient = 0;\n        let _jianyaoTimes = 0;\n        for(let item of orderObj){\n          if(item.medType == \"免煎药\"){\n            _incomeMianjian = parseFloat((_incomeMianjian + item.total).toFixed(2));\n            _profitMianjian = parseFloat((_profitMianjian + item.totalprofit).toFixed(2));\n          } \n          else if(item.medType == \"草药\"){\n            _incomeCaoyao = parseFloat((_incomeCaoyao + item.total).toFixed(2));\n            _profitCaoyao = parseFloat((_profitCaoyao + item.totalprofit).toFixed(2));\n          }\n          else if(item.medType == \"西药\"){\n            _incomeXiyao = parseFloat((_incomeXiyao + item.total).toFixed(2));\n            _profitXiyao = parseFloat((_profitXiyao + item.totalprofit).toFixed(2));\n          }\n          _totalIncome = parseFloat((_totalIncome + item.total).toFixed(2));\n          _totalProfit = parseFloat((_totalProfit + item.totalprofit).toFixed(2));\n          _taotalPatient = _taotalPatient + 1;\n          \n          if(parseInt(item.age) > 20){\n            _gt20Patient = _gt20Patient + 1;\n          }else{\n            _lt20Patient = _lt20Patient + 1;\n          }\n          let searchStr = JSON.stringify(item.med);\n          if(searchStr.indexOf('煎药') != -1){\n            _jianyaoTimes = _jianyaoTimes + 1;\n          }\n        }\n\n        for(let item of otherEntryObj){\n          if(item.detailType == \"药丸\"){\n            _incomeYaowan = parseFloat((_incomeYaowan + item.amount).toFixed(2));\n            _profitYaowan = parseFloat((_profitYaowan + item.profit).toFixed(2));\n          }\n          _totalIncome = parseFloat((_totalIncome + item.amount).toFixed(2));\n          _totalProfit = parseFloat((_totalProfit + item.profit).toFixed(2));\n          _taotalPatient = _taotalPatient + 1;\n\n        }\n        _averageIncome = parseFloat((_totalIncome / days).toFixed(2));\n        _averageProfit = parseFloat((_totalProfit / days).toFixed(2));\n        _averagePatient = parseFloat((_taotalPatient / days).toFixed(2));\n        //赋值\n        this.totalIncome = _totalIncome;\n        this.totalProfit = _totalProfit;\n        this.averageIncome = _averageIncome;\n        this.averageProfit = _averageProfit;\n        //收入\n        this.incomeMianjian = _incomeMianjian;\n        this.incomeCaoyao = _incomeCaoyao;\n        this.incomeXiyao = _incomeXiyao;\n        this.incomeYaowan = _incomeYaowan;\n        //利润\n        this.profitMianjian = _profitMianjian;\n        this.profitCaoyao = _profitCaoyao;\n        this.profitXiyao = _profitXiyao;\n        this.profitYaowan = _profitYaowan;\n        //病人\n        this.totalPatient = _taotalPatient;\n        this.averagePatient = _averagePatient;\n        this.gt20Patient = _gt20Patient;\n        this.lt20Patient = _lt20Patient;\n        //其它\n        this.jianyaoTimes = _jianyaoTimes;\n      },\n    },\n\n    mounted: function() {\n\t\t\tthis.getAll();\n    },\n    \n    computed: {\n      dateRangeText () {\n        return this.dates.join(' ~ ')\n      },\n    },\n\n    \n  }\n",{"version":3,"sources":["DetailInfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiDA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA","file":"DetailInfo.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <v-container\n    fill-height\n    fluid\n    grid-list-xl\n  >\n    <v-row justify=\"center\">\n      <v-col cols=\"12\">\n        <material-card \n          flat\n\t\t\t\t\tcolor=\"green\"\n          title=\"详细统计\"\n        >\n          <v-row>\n            <v-col cols=\"12\" sm=\"12\" lg=\"4\" md=\"4\">\n              <v-date-picker v-model=\"dates\" range color=\"green\"></v-date-picker>\n            </v-col>\n            <v-col cols=\"12\" sm=\"12\" lg=\"8\" md=\"8\">              \n              <v-card\n                class=\"mx-auto\"\n              >\n                <v-card-text>\n                  <v-text-field v-model=\"dateRangeText\" label=\"时间范围\" readonly append-icon=\"mdi-check-bold\" color=\"blue darken-2\" @click:append=\"actionGenerate\"></v-text-field>\n                  <div  ref=\"print\" v-if=\"reportDisplay\">\n                    <h3 style=\"text-align:center\">{{dateRangeText}} 详情</h3>\n                    <v-list subheader>\n                      <v-list-item>\n                        <v-list-item-content>\n                          <v-list-item-title>总收入</v-list-item-title>\n                        </v-list-item-content>\n                        <v-list-item-action>\n                          <v-list-item-title>{{totalIncome}}元</v-list-item-title>\n                        </v-list-item-action>\n                      </v-list-item>\n                      <v-divider></v-divider>\n                      <v-subheader>总计</v-subheader>\n                    </v-list>\n                  </div>\n                </v-card-text>\n              </v-card>\n            </v-col>\n          </v-row>\n        </material-card>\n      </v-col>\n    </v-row>\n  </v-container>\n</template>\n\n<script>\n  export default {\n    data: () => ({\n      dates: ['2019-09-10', '2019-09-20'],\n      reportDisplay: false,\n      totalIncome: 0\n    }),\n\n    methods: {\n      actionGenerate: function(){\n        this.reportDisplay = true;\n        var start = this.dates[0];\n        var end = this.dates[1];\n        var range = {\n          startDate: start,\n          endDate: end,\n        };\n        this.startDay = start;\n        this.endDay = end;\n        var orderObj = [];\n        var otherEntryObj = [];\n        let days = 0;\n        days = (this.dateRange[1] - this.dateRange[0]) / (1000*3600*24) + 1;\n        this.$http.get(\"/ordapi/getOrderStatement\", {params:range})\n        .then(\n          function(response) {\n            orderObj = response.data;\n            this.$http.get(\"/othentryapi/getOtherEntryRange\", {params:range}).then(response => {\n              otherEntryObj = response.data;\n              this.calculateAndAnalysis(orderObj, otherEntryObj, days);\n            })\t\t\t\t\t\t\t\n          }\n        );\n      },\n\n      calculateAndAnalysis: function(orderObj,otherEntryObj,days){\n        //alert(orderObj.length);\n        //alert(otherEntryObj.length);\n        let _totalIncome = 0, _totalProfit = 0, _averageIncome = 0, _averageProfit = 0;\n        let _incomeMianjian = 0, _incomeXiyao = 0, _incomeYaowan = 0, _incomeCaoyao = 0;\n        let _profitMianjian = 0, _profitXiyao = 0, _profitYaowan = 0, _profitCaoyao = 0;\n        let _taotalPatient = 0, _averagePatient = 0, _gt20Patient = 0, _lt20Patient = 0;\n        let _jianyaoTimes = 0;\n        for(let item of orderObj){\n          if(item.medType == \"免煎药\"){\n            _incomeMianjian = parseFloat((_incomeMianjian + item.total).toFixed(2));\n            _profitMianjian = parseFloat((_profitMianjian + item.totalprofit).toFixed(2));\n          } \n          else if(item.medType == \"草药\"){\n            _incomeCaoyao = parseFloat((_incomeCaoyao + item.total).toFixed(2));\n            _profitCaoyao = parseFloat((_profitCaoyao + item.totalprofit).toFixed(2));\n          }\n          else if(item.medType == \"西药\"){\n            _incomeXiyao = parseFloat((_incomeXiyao + item.total).toFixed(2));\n            _profitXiyao = parseFloat((_profitXiyao + item.totalprofit).toFixed(2));\n          }\n          _totalIncome = parseFloat((_totalIncome + item.total).toFixed(2));\n          _totalProfit = parseFloat((_totalProfit + item.totalprofit).toFixed(2));\n          _taotalPatient = _taotalPatient + 1;\n          \n          if(parseInt(item.age) > 20){\n            _gt20Patient = _gt20Patient + 1;\n          }else{\n            _lt20Patient = _lt20Patient + 1;\n          }\n          let searchStr = JSON.stringify(item.med);\n          if(searchStr.indexOf('煎药') != -1){\n            _jianyaoTimes = _jianyaoTimes + 1;\n          }\n        }\n\n        for(let item of otherEntryObj){\n          if(item.detailType == \"药丸\"){\n            _incomeYaowan = parseFloat((_incomeYaowan + item.amount).toFixed(2));\n            _profitYaowan = parseFloat((_profitYaowan + item.profit).toFixed(2));\n          }\n          _totalIncome = parseFloat((_totalIncome + item.amount).toFixed(2));\n          _totalProfit = parseFloat((_totalProfit + item.profit).toFixed(2));\n          _taotalPatient = _taotalPatient + 1;\n\n        }\n        _averageIncome = parseFloat((_totalIncome / days).toFixed(2));\n        _averageProfit = parseFloat((_totalProfit / days).toFixed(2));\n        _averagePatient = parseFloat((_taotalPatient / days).toFixed(2));\n        //赋值\n        this.totalIncome = _totalIncome;\n        this.totalProfit = _totalProfit;\n        this.averageIncome = _averageIncome;\n        this.averageProfit = _averageProfit;\n        //收入\n        this.incomeMianjian = _incomeMianjian;\n        this.incomeCaoyao = _incomeCaoyao;\n        this.incomeXiyao = _incomeXiyao;\n        this.incomeYaowan = _incomeYaowan;\n        //利润\n        this.profitMianjian = _profitMianjian;\n        this.profitCaoyao = _profitCaoyao;\n        this.profitXiyao = _profitXiyao;\n        this.profitYaowan = _profitYaowan;\n        //病人\n        this.totalPatient = _taotalPatient;\n        this.averagePatient = _averagePatient;\n        this.gt20Patient = _gt20Patient;\n        this.lt20Patient = _lt20Patient;\n        //其它\n        this.jianyaoTimes = _jianyaoTimes;\n      },\n    },\n\n    mounted: function() {\n\t\t\tthis.getAll();\n    },\n    \n    computed: {\n      dateRangeText () {\n        return this.dates.join(' ~ ')\n      },\n    },\n\n    \n  }\n</script>\n"]}]}