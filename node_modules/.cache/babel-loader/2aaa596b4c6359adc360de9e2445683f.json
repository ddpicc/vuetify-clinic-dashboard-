{"remainingRequest":"/home/qc/Documents/vuetify-clinic-dashboard-/node_modules/babel-loader/lib/index.js!/home/qc/Documents/vuetify-clinic-dashboard-/node_modules/eslint-loader/index.js??ref--13-0!/home/qc/Documents/vuetify-clinic-dashboard-/src/login.js","dependencies":[{"path":"/home/qc/Documents/vuetify-clinic-dashboard-/src/login.js","mtime":1581225491753},{"path":"/home/qc/Documents/vuetify-clinic-dashboard-/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/qc/Documents/vuetify-clinic-dashboard-/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/qc/Documents/vuetify-clinic-dashboard-/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.object.define-property\";\nimport \"core-js/modules/es6.object.define-properties\";\nimport \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.array.for-each\";\nimport \"core-js/modules/es6.array.filter\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _defineProperty from \"/home/qc/Documents/vuetify-clinic-dashboard-/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"core-js/modules/es6.array.some\";\nimport \"core-js/modules/es6.array.index-of\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport router from \"./router\";\nimport store from \"./store\";\n\nfunction hasPermission(roles, permissionRoles) {\n  if (roles.indexOf('admin') >= 0) return true; // admin权限 直接通过\n\n  if (!permissionRoles) return true;\n  return roles.some(function (role) {\n    return permissionRoles.indexOf(role) >= 0;\n  });\n}\n\nvar whiteList = ['/login', '/']; // 不重定向白名单\n\nrouter.beforeEach(function (to, from, next) {\n  if (store.state.user.token) {\n    // 判断是否有token\n    if (to.path === '/login') {\n      next({\n        path: '/dashboard'\n      });\n    } else {\n      if (store.state.user.roles.length === 0) {\n        // 判断当前用户是否已拉取完user_info信息\n        store.dispatch('user/GetInfo').then(function (res) {\n          // 拉取user_info\n          var roles = res.data[0].role;\n          store.dispatch('permission/GenerateRoutes', {\n            roles: roles\n          }).then(function () {\n            // 生成可访问的路由表\n            router.addRoutes(store.state.permission.addRouters); // 动态添加可访问路由表\n\n            next(_objectSpread({}, to)); // hack方法 确保addRoutes已完成\n          });\n        }).catch(function (err) {\n          console.log('all good');\n          store.dispatch('user/FedLogOut').then(function () {\n            next({\n              path: '/login'\n            });\n          });\n        });\n      } else {\n        //store.dispatch('permission/getNowRoutes', to);\n        if (hasPermission(store.state.user.roles, to.meta.role)) {\n          next(); //\n        } else {\n          next({\n            path: '/'\n          });\n        }\n      }\n    }\n  } else {\n    if (whiteList.indexOf(to.path) !== -1) {\n      // 在免登录白名单，直接进入\n      next();\n    } else {\n      next('/login'); // 否则全部重定向到登录页\n    }\n  }\n});",{"version":3,"sources":["/home/qc/Documents/vuetify-clinic-dashboard-/src/login.js"],"names":["router","store","hasPermission","roles","permissionRoles","indexOf","some","role","whiteList","beforeEach","to","from","next","state","user","token","path","length","dispatch","then","res","data","addRoutes","permission","addRouters","catch","err","console","log","meta"],"mappings":";;;;;;;;;;;;;;;AAAA,OAAOA,MAAP;AACA,OAAOC,KAAP;;AAGA,SAASC,aAAT,CAAuBC,KAAvB,EAA8BC,eAA9B,EAA+C;AAC9C,MAAID,KAAK,CAACE,OAAN,CAAc,OAAd,KAA0B,CAA9B,EAAiC,OAAO,IAAP,CADa,CACD;;AAC7C,MAAI,CAACD,eAAL,EAAsB,OAAO,IAAP;AACtB,SAAOD,KAAK,CAACG,IAAN,CAAW,UAAAC,IAAI;AAAA,WAAIH,eAAe,CAACC,OAAhB,CAAwBE,IAAxB,KAAiC,CAArC;AAAA,GAAf,CAAP;AACA;;AAED,IAAMC,SAAS,GAAG,CAAC,QAAD,EAAU,GAAV,CAAlB,C,CAAgC;;AAChCR,MAAM,CAACS,UAAP,CAAkB,UAACC,EAAD,EAAKC,IAAL,EAAWC,IAAX,EAAoB;AACrC,MAAIX,KAAK,CAACY,KAAN,CAAYC,IAAZ,CAAiBC,KAArB,EAA4B;AAAE;AAC5B,QAAIL,EAAE,CAACM,IAAH,KAAY,QAAhB,EAA0B;AAC1BJ,MAAAA,IAAI,CAAC;AAAEI,QAAAA,IAAI,EAAE;AAAR,OAAD,CAAJ;AACC,KAFD,MAEO;AACP,UAAIf,KAAK,CAACY,KAAN,CAAYC,IAAZ,CAAiBX,KAAjB,CAAuBc,MAAvB,KAAkC,CAAtC,EAAyC;AAAE;AAC1ChB,QAAAA,KAAK,CAACiB,QAAN,CAAe,cAAf,EAA+BC,IAA/B,CAAoC,UAAAC,GAAG,EAAI;AAAE;AAC7C,cAAMjB,KAAK,GAAGiB,GAAG,CAACC,IAAJ,CAAS,CAAT,EAAYd,IAA1B;AACAN,UAAAA,KAAK,CAACiB,QAAN,CAAe,2BAAf,EAA4C;AAAEf,YAAAA,KAAK,EAALA;AAAF,WAA5C,EAAuDgB,IAAvD,CAA4D,YAAM;AAAE;AACnEnB,YAAAA,MAAM,CAACsB,SAAP,CAAiBrB,KAAK,CAACY,KAAN,CAAYU,UAAZ,CAAuBC,UAAxC,EADiE,CACZ;;AACrDZ,YAAAA,IAAI,mBAAMF,EAAN,EAAJ,CAFiE,CAEhD;AAChB,WAHF;AAIC,SAND,EAMGe,KANH,CAMS,UAAAC,GAAG,EAAI;AACfC,UAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ;AACA3B,UAAAA,KAAK,CAACiB,QAAN,CAAe,gBAAf,EAAiCC,IAAjC,CAAsC,YAAM;AAC3CP,YAAAA,IAAI,CAAC;AAAEI,cAAAA,IAAI,EAAE;AAAR,aAAD,CAAJ;AACA,WAFD;AAGA,SAXD;AAYA,OAbD,MAaO;AACN;AAEC,YAAId,aAAa,CAACD,KAAK,CAACY,KAAN,CAAYC,IAAZ,CAAiBX,KAAlB,EAAyBO,EAAE,CAACmB,IAAH,CAAQtB,IAAjC,CAAjB,EAAyD;AACzDK,UAAAA,IAAI,GADqD,CACnD;AACL,SAFD,MAEO;AACPA,UAAAA,IAAI,CAAC;AAAEI,YAAAA,IAAI,EAAE;AAAR,WAAD,CAAJ;AACC;AACF;AACA;AACF,GA3BD,MA2BO;AACL,QAAIR,SAAS,CAACH,OAAV,CAAkBK,EAAE,CAACM,IAArB,MAA+B,CAAC,CAApC,EAAuC;AAAE;AACzCJ,MAAAA,IAAI;AACH,KAFD,MAEO;AACPA,MAAAA,IAAI,CAAC,QAAD,CAAJ,CADO,CACQ;AACd;AACF;AACD,CAnCD","sourcesContent":["import router from './router'\nimport store from './store'\n\n\nfunction hasPermission(roles, permissionRoles) {\n\tif (roles.indexOf('admin') >= 0) return true // admin权限 直接通过\n\tif (!permissionRoles) return true\n\treturn roles.some(role => permissionRoles.indexOf(role) >= 0)\n}\n\nconst whiteList = ['/login','/']// 不重定向白名单\nrouter.beforeEach((to, from, next) => {\n\tif (store.state.user.token) { // 判断是否有token\n\t  if (to.path === '/login') {\n\t\t\tnext({ path: '/dashboard' })\n\t  } else {\n\t\t\tif (store.state.user.roles.length === 0) { // 判断当前用户是否已拉取完user_info信息\n\t\t\t\tstore.dispatch('user/GetInfo').then(res => { // 拉取user_info\n\t\t\t\tconst roles = res.data[0].role;  \n\t\t\t\tstore.dispatch('permission/GenerateRoutes', { roles }).then(() => { // 生成可访问的路由表\n\t\t\t\t\trouter.addRoutes(store.state.permission.addRouters); // 动态添加可访问路由表\n\t\t\t\t\tnext({ ...to }); // hack方法 确保addRoutes已完成\n\t\t\t\t\t})\n\t\t\t\t}).catch(err => {\n\t\t\t\t\tconsole.log('all good');\n\t\t\t\t\tstore.dispatch('user/FedLogOut').then(() => {\n\t\t\t\t\t\tnext({ path: '/login' })\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t} else {\t\t  \n\t\t  //store.dispatch('permission/getNowRoutes', to);\n  \n\t\t  \tif (hasPermission(store.state.user.roles, to.meta.role)) {\n\t\t\t\t\tnext()//\n\t\t  \t} else {\n\t\t\t\t\tnext({ path: '/'})\n\t\t  \t}\n\t\t\t}\n\t  }\n\t} else {\n\t  if (whiteList.indexOf(to.path) !== -1) { // 在免登录白名单，直接进入\n\t\t\tnext()\n\t  } else {\n\t\t\tnext('/login') // 否则全部重定向到登录页\n\t  }\n\t}\n})"]}]}